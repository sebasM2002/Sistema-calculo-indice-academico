
@using CalculoIndiceAcademico.Data;
@using CalculoIndiceAcademico.Models;
@using Microsoft.Data.SqlClient;
@model APUser
@{
    ViewData["Title"] = "Register";
}
@{
    SqlConnection connection3 = new SqlConnection();
    connection3.ConnectionString = "Server=ROMAN\\SQLEXPRESS;Database=aspnet-CalculoIndiceAcademico-6105572f-b1d8-4855-9c87-d6a125b92b4b;Trusted_Connection=True;MultipleActiveResultSets=true";
    connection3.Open();
    SqlCommand command3 = new SqlCommand();
    command3.Connection = connection3;
    command3.CommandText = "select * from Careers";
    SqlDataReader reader3 = command3.ExecuteReader();
    var careerList = new List<CareerModel>();
    while (reader3.Read())
    {
        CareerModel obj = new CareerModel();
        obj.ID_Career = $"{reader3["ID_Career"]}";
        obj.Career = $"{reader3["Career"]}";
        careerList.Add(obj);
    }
    reader3.Close();
    connection3.Close();


    SqlConnection connection = new SqlConnection();
    connection.ConnectionString = "Server=ROMAN\\SQLEXPRESS;Database=aspnet-CalculoIndiceAcademico-6105572f-b1d8-4855-9c87-d6a125b92b4b;Trusted_Connection=True;MultipleActiveResultSets=true";
    connection.Open();
    SqlCommand command = new SqlCommand();
    command.Connection = connection;
    command.CommandText = "select * from Table_1";
    SqlDataReader reader = command.ExecuteReader();
    List<Table_1> objList = new List<Table_1>();

    while (reader.Read())
    {
        var obj = new Table_1();
        obj.Data1 = $"{reader["Data1"]}";
        obj.Data2 = $"{reader["Data2"]}";
        objList.Add(obj);
    }
    command.Dispose();
    reader.Dispose();
    connection.Dispose();

    SqlConnection connection2 = new SqlConnection();
    connection2.ConnectionString = "Server=ROMAN\\SQLEXPRESS;Database=aspnet-CalculoIndiceAcademico-6105572f-b1d8-4855-9c87-d6a125b92b4b;Trusted_Connection=True;MultipleActiveResultSets=true";
    connection2.Open();
    SqlCommand command2 = new SqlCommand();
    command2.Connection = connection2;
    List<string> userList = new List<string>();
    command2.CommandText = "select * from Peoples";
    SqlDataReader reader2 = command2.ExecuteReader();
    while (reader2.Read())
    {
        var obj = new APUser();
        obj.EMail = $"{reader2["EMail"]}";
        userList.Add(obj.EMail);
    }
    reader2.Close();
    var registrosABorrar = new List<Table_1>();

    foreach(var user in objList)
    {
        foreach(var register in userList)
        {
            if (user.Data1 == register)
            {
                registrosABorrar.Add(user);
            }
        } 
    }

    foreach(var number in registrosABorrar)
    {
        objList.Remove(number);
    }



    var random = new Random();
    int index = random.Next(0,objList.Count);

    string userID = string.Empty;

    foreach (char c in objList[index].Data1)
    {
        if (c == '@')
            break;

        userID += c;
    }
}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

<div class="row d-flex justify-content-center mt-5">
    <div class="col-md-5" style="background-color:#0B4F6C; border-radius: 10px; box-shadow: 5px 10px 10px black">
            <h1 class="d-flex justify-content-center mt-5" style="color:white">Registra un nuevo Usuario</h1>
            <div class="card-body">
                <form id="registerForm" method="post">

                <h4><span class="ms-2 mb-3" style="color:white">Rol</span></h4>
                    <div class="dropdown mb-3">
                        <select asp-for="Role" class="form-control" style="width:25%">
                            <option value="Estudiante">Estudiante</option>
                            <option value="Profesor">Profesor</option>
                            <option value="Coordinador">Coordinador</option>
                            <option value="Administrador">Administrador</option>
                        </select>
                    <span asp-validation-for="Role" class="text-danger"></span>
                     
                    </div>
                <hr style="background-color:white" />
                <h4><span class="ms-2 mb-3" style="color:white">Cuenta</span></h4>
                <div class="mb-3" style="width:30%">
                    <span class="ms-2" style="color:white">ID</span>
                    <input asp-for="UserID" readonly class="form-control" class="form-control" value="@userID">
                    <span asp-validation-for="UserID" class="text-danger"></span>
                </div>

                <div class="mb-3" style="width:30%">
                    <span class="ms-2" style="color:white">E-Mail</span>
                    <input asp-for="EMail" readonly class="form-control" class="form-control" value="@objList[index].Data1">
                    <span asp-validation-for="EMail" class="text-danger"></span>
                </div>

                <div class="mb-3" style="width:30%">
                    <span class="ms-2" style="color:white">Contraseña</span>
                    <div class="form-control" readonly>@objList[index].Data2</div>
                </div>
                
                <hr style="background-color:white"/>
                <h4><span class="ms-2 mb-3" style="color:white">Nombre Completo</span></h4>
                    <div class="row">
                        <div class="mb-3 col-6">
                        <input asp-for="Name" type="text" class="form-control" placeholder="Nombre" aria-label="Nombre">
                        <span asp-validation-for="Name" class="text-danger"></span>
                        </div>
                        <div class="mb-3 col-6">
                        <input asp-for="LastName" type="text" class="form-control" placeholder="Apellido" aria-label="Apellido">
                        <span asp-validation-for="LastName" class="text-danger"></span>
                        </div>
                    </div>
                <div class="dropdown mb-3">
                    <span class="ms-2" style="color:white">Genero</span>
                    <select asp-for="Gender" class="form-control" style="width:25%">
                        <option value="Estudiante">M</option>
                        <option value="Profesor">F</option>
                    </select>
                    <span asp-validation-for="Gender" class="text-danger"></span>

                </div>

                <div class="row">
                    <div class="mb-3" style="width:30%">
                        <span class="ms-2" style="color:white">Fecha de Nacimiento</span>
                        <input asp-for="BirthDate" type="date" class="form-control" aria-label="FechaDeNacimiento">
                        <span asp-validation-for="BirthDate" class="text-danger"></span>
                    </div>
                    <div class="mb-3" style="width:20%">
                        <span class="ms-2" style="color:white">Edad</span>
                        <input asp-for="age" type="number" class="form-control" aria-label="Edad">
                        <span asp-validation-for="age" class="text-danger"></span>
                    </div>
                </div>

                <div class="mb-3" style="width:30%">
                    <span class="ms-2" style="color:white">Cédula</span>
                    <input asp-for="Identification" type="number" class="form-control" class="form-control" placeholder="000-000000000-0" aria-label="Cedula">
                    <span asp-validation-for="Identification" class="text-danger"></span>
                </div>


                <div class="mb-3" style="width:30%">
                    <span class="ms-2" style="color:white">Address</span>
                    <input asp-for="AddressLine" type="tel" class="form-control" placeholder="(###)-###-####" aria-label="NumeroCel">
                    <span asp-validation-for="AddressLine" class="text-danger"></span>
                </div>


                <div class="dropdown mb-3" style="width:80%">
                    <div class="ms-2" style="color:white">Area Académica</div>
                    <select asp-for="AcademicArea" class="form-control">
                        @{
                            foreach(var obj in careerList)
                            {
                                <option value="@obj.ID_Career">@obj.ID_Career - @obj.Career</option>
                            }
                        }
                    </select>
                    <span asp-validation-for="AcademicArea" class="text-danger"></span>
                </div>

                    <div class="text-center mt-5" stlye="height:100px">
                    <a asp-area="" asp-controller="ApplicationUser" asp-action="Register"><button type="submit" class="btn btn-primary me-3 mb-5" style="width:30%; height:50px; border-radius: 10px; background-color: #01BAEF">Crear Cuenta</button></a>
                    <a asp-area="" asp-controller="Home" asp-action="Index"><button type="button" class="btn btn-outline-danger mb-5" style="width:30%; height:50px; border-radius: 10px">Cancelar</button></a>
                    </div>
                </form>
            </div>
     </div>
</div>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}
